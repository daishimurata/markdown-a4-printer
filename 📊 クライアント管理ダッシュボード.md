# ğŸ“Š ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

> **æœ€çµ‚æ›´æ–°**: 2025-06-11  
> **å¯¾è±¡ãƒ‡ãƒ¼ã‚¿**: ClientFaceSheetsãƒ•ã‚©ãƒ«ãƒ€

## ğŸ¯ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåŸºæœ¬æƒ…å ±

### ğŸ“‹ å…¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä¸€è¦§

```dataviewjs
// Scripts/client_facesheet_dataview_queries.js ã‹ã‚‰ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œ
const FOLDER_PATH = "ClientFaceSheets";
const EXCLUDE_FILES = ["dbfolder.json", "README.md", "ãƒ•ã‚§ã‚¤ã‚¹ã‚·ãƒ¼ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ.md"];

function formatDate(dateStr) {
    if (!dateStr) return "";
    const date = new Date(dateStr);
    return date.toLocaleDateString('ja-JP', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit'
    });
}

function getStatusColor(status) {
    const colors = {
        "active": "#4CAF50",
        "trial": "#2196F3", 
        "considering": "#FF9800",
        "ended": "#9E9E9E"
    };
    return colors[status] || "#9E9E9E";
}

function getStatusLabel(status) {
    const labels = {
        "active": "åˆ©ç”¨ä¸­",
        "trial": "ä½“é¨“ä¸­",
        "considering": "æ¤œè¨ä¸­", 
        "ended": "åˆ©ç”¨çµ‚äº†"
    };
    return labels[status] || status;
}

function getGenderLabel(gender) {
    return gender === "male" ? "ç”·æ€§" : "å¥³æ€§";
}

function getDisabilityClassLabel(disabilityClass) {
    const labels = {
        "class1": "åŒºåˆ†1",
        "class2": "åŒºåˆ†2", 
        "class3": "åŒºåˆ†3",
        "class4": "åŒºåˆ†4",
        "class5": "åŒºåˆ†5",
        "class6": "åŒºåˆ†6"
    };
    return labels[disabilityClass] || disabilityClass;
}

function getResidenceTypeLabel(residenceType) {
    const labels = {
        "gh": "ã‚°ãƒ«ãƒ¼ãƒ—ãƒ›ãƒ¼ãƒ ",
        "home": "è‡ªå®…",
        "facility": "æ–½è¨­å…¥æ‰€",
        "other": "ãã®ä»–"
    };
    return labels[residenceType] || residenceType;
}

// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä¸€è¦§è¡¨ç¤º
const clients = dv.pages(`"${FOLDER_PATH}"`)
    .where(p => !EXCLUDE_FILES.some(file => p.file.name.includes(file.replace('.md', ''))))
    .sort(p => p.client_name);

if (clients.length === 0) {
    dv.paragraph("ğŸ“‹ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");
} else {
    const tableData = clients.map(client => [
        `[[${client.file.name}|${client.client_name || "æœªå…¥åŠ›"}]]`,
        client.age ? `${client.age}æ­³` : "",
        getGenderLabel(client.gender),
        getDisabilityClassLabel(client.disability_class),
        getResidenceTypeLabel(client.residence_type),
        `<span style="color: ${getStatusColor(client.status)}; font-weight: bold;">${getStatusLabel(client.status)}</span>`,
        formatDate(client.start_date),
        formatDate(client.last_updated)
    ]);
    
    dv.table(
        ["æ°å", "å¹´é½¢", "æ€§åˆ¥", "éšœå®³æ”¯æ´åŒºåˆ†", "å±…ä½å½¢æ…‹", "åˆ©ç”¨çŠ¶æ³", "åˆ©ç”¨é–‹å§‹æ—¥", "æœ€çµ‚æ›´æ–°"],
        tableData
    );
}
```

---

## ğŸ“Š åˆ©ç”¨çŠ¶æ³åˆ¥ã‚µãƒãƒªãƒ¼

```dataviewjs
// åˆ©ç”¨çŠ¶æ³åˆ¥ã‚µãƒãƒªãƒ¼
const clients = dv.pages(`"${FOLDER_PATH}"`)
    .where(p => !EXCLUDE_FILES.some(file => p.file.name.includes(file.replace('.md', ''))));

const statusCounts = {};
clients.forEach(client => {
    const status = client.status || "æœªè¨­å®š";
    statusCounts[status] = (statusCounts[status] || 0) + 1;
});

const summaryData = Object.entries(statusCounts).map(([status, count]) => [
    `<span style="color: ${getStatusColor(status)}; font-weight: bold;">${getStatusLabel(status)}</span>`,
    `${count}å`,
    `${Math.round((count / clients.length) * 100)}%`
]);

dv.table(["åˆ©ç”¨çŠ¶æ³", "äººæ•°", "å‰²åˆ"], summaryData);
```

---

## ğŸ¥ åŒ»ç™‚æ©Ÿé–¢åˆ¥ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä¸€è¦§

```dataviewjs
// åŒ»ç™‚æ©Ÿé–¢åˆ¥ä¸€è¦§
const clientsWithMedical = dv.pages(`"${FOLDER_PATH}"`)
    .where(p => !EXCLUDE_FILES.some(file => p.file.name.includes(file.replace('.md', ''))))
    .where(p => p.medical_institution);

if (clientsWithMedical.length === 0) {
    dv.paragraph("ğŸ¥ åŒ»ç™‚æ©Ÿé–¢æƒ…å ±ãŒç™»éŒ²ã•ã‚ŒãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒã„ã¾ã›ã‚“ã€‚");
} else {
    const institutionGroups = {};
    clientsWithMedical.forEach(client => {
        const institution = client.medical_institution || "æœªç™»éŒ²";
        if (!institutionGroups[institution]) {
            institutionGroups[institution] = [];
        }
        institutionGroups[institution].push(client);
    });
    
    Object.entries(institutionGroups).forEach(([institution, clientList]) => {
        dv.header(4, `${institution} (${clientList.length}å)`);
        
        const tableData = clientList.map(client => [
            `[[${client.file.name}|${client.client_name}]]`,
            client.main_doctor || "",
            client.visit_frequency || "",
            client.clinic_phone || ""
        ]);
        
        dv.table(
            ["æ°å", "ä¸»æ²»åŒ»", "å—è¨ºé »åº¦", "é›»è©±ç•ªå·"],
            tableData
        );
    });
}
```

---

## ğŸ’° çµŒæ¸ˆçŠ¶æ³ã‚µãƒãƒªãƒ¼

```dataviewjs
// çµŒæ¸ˆçŠ¶æ³åˆ†æ
const clientsWithEconomic = dv.pages(`"${FOLDER_PATH}"`)
    .where(p => !EXCLUDE_FILES.some(file => p.file.name.includes(file.replace('.md', ''))))
    .where(p => p.pension_amount || p.savings_amount || p.gh_fee);

if (clientsWithEconomic.length === 0) {
    dv.paragraph("ğŸ’° çµŒæ¸ˆæƒ…å ±ãŒç™»éŒ²ã•ã‚ŒãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒã„ã¾ã›ã‚“ã€‚");
} else {
    dv.header(4, `çµŒæ¸ˆçŠ¶æ³ãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (${clientsWithEconomic.length}å)`);
    
    const economicData = clientsWithEconomic.map(client => [
        `[[${client.file.name}|${client.client_name}]]`,
        client.pension_amount ? `${client.pension_amount.toLocaleString()}å††/æœˆ` : "",
        client.savings_amount ? `ç´„${client.savings_amount.toLocaleString()}å††` : "",
        client.gh_fee ? `${client.gh_fee.toLocaleString()}å††/æœˆ` : "",
        getStatusLabel(client.status)
    ]);
    
    dv.table(
        ["æ°å", "éšœå®³å¹´é‡‘", "é é‡‘é¡", "GHåˆ©ç”¨æ–™", "åˆ©ç”¨çŠ¶æ³"],
        economicData
    );
}
```

---

## ğŸ“… æœ€è¿‘ã®æ›´æ–°çŠ¶æ³

```dataviewjs
// æœ€è¿‘æ›´æ–°ã•ã‚ŒãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆ30æ—¥ä»¥å†…ï¼‰
const thirtyDaysAgo = new Date();
thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);

const recentUpdates = dv.pages(`"${FOLDER_PATH}"`)
    .where(p => !EXCLUDE_FILES.some(file => p.file.name.includes(file.replace('.md', ''))))
    .where(p => p.last_updated && new Date(p.last_updated) >= thirtyDaysAgo)
    .sort(p => p.last_updated, 'desc');

if (recentUpdates.length === 0) {
    dv.paragraph("ğŸ“… éå»30æ—¥é–“ã«æ›´æ–°ã•ã‚ŒãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæƒ…å ±ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚");
} else {
    dv.header(4, `æœ€è¿‘æ›´æ–°ã•ã‚ŒãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (${recentUpdates.length}å)`);
    
    const recentData = recentUpdates.map(client => [
        `[[${client.file.name}|${client.client_name}]]`,
        formatDate(client.last_updated),
        `<span style="color: ${getStatusColor(client.status)}; font-weight: bold;">${getStatusLabel(client.status)}</span>`,
        client.medical_institution || ""
    ]);
    
    dv.table(
        ["æ°å", "æœ€çµ‚æ›´æ–°æ—¥", "åˆ©ç”¨çŠ¶æ³", "åŒ»ç™‚æ©Ÿé–¢"],
        recentData
    );
}
```

---

## ğŸ’¾ CSVå‡ºåŠ›æ©Ÿèƒ½

```dataviewjs
// CSVå‡ºåŠ›
const allClients = dv.pages(`"${FOLDER_PATH}"`)
    .where(p => !EXCLUDE_FILES.some(file => p.file.name.includes(file.replace('.md', ''))));

if (allClients.length === 0) {
    dv.paragraph("âŒ CSVå‡ºåŠ›ç”¨ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");
} else {
    // CSVãƒ˜ãƒƒãƒ€ãƒ¼
    const headers = [
        "æ°å", "ç”Ÿå¹´æœˆæ—¥", "å¹´é½¢", "æ€§åˆ¥", "éšœå®³æ”¯æ´åŒºåˆ†", "ä½æ‰€", "é›»è©±ç•ªå·",
        "å±…ä½å½¢æ…‹", "åˆ©ç”¨çŠ¶æ³", "åˆ©ç”¨é–‹å§‹æ—¥", "å—çµ¦è€…è¨¼ç•ªå·", "åŒ»ç™‚æ©Ÿé–¢å",
        "ä¸»æ²»åŒ»", "å—è¨ºé »åº¦", "ç™‚è‚²æ‰‹å¸³", "ç²¾ç¥ç–¾æ‚£", "éšœå®³å¹´é‡‘", "é é‡‘é¡",
        "GHåˆ©ç”¨æ–™", "æœ€çµ‚æ›´æ–°æ—¥"
    ];
    
    // CSVãƒ‡ãƒ¼ã‚¿
    const csvData = allClients.map(client => [
        client.client_name || "",
        client.birth_date || "",
        client.age || "",
        getGenderLabel(client.gender),
        getDisabilityClassLabel(client.disability_class),
        client.address || "",
        client.phone || "",
        getResidenceTypeLabel(client.residence_type),
        getStatusLabel(client.status),
        formatDate(client.start_date),
        client.recipient_number || "",
        client.medical_institution || "",
        client.main_doctor || "",
        client.visit_frequency || "",
        client.therapeutic_notebook || "",
        client.mental_illness || "",
        client.pension_amount ? `${client.pension_amount}å††/æœˆ` : "",
        client.savings_amount ? `ç´„${client.savings_amount}å††` : "",
        client.gh_fee ? `${client.gh_fee}å††/æœˆ` : "",
        formatDate(client.last_updated)
    ]);
    
    // CSVæ–‡å­—åˆ—ç”Ÿæˆ
    let csvContent = headers.join(",") + "\n";
    csvData.forEach(row => {
        const escapedRow = row.map(field => 
            typeof field === 'string' && field.includes(',') 
                ? `"${field.replace(/"/g, '""')}"` 
                : field
        );
        csvContent += escapedRow.join(",") + "\n";
    });
    
    dv.paragraph(`ğŸ“Š **${allClients.length}ä»¶ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæƒ…å ±**ã‚’CSVå½¢å¼ã§å‡ºåŠ›ã—ã¾ã™ã€‚`);
    dv.paragraph("â¬‡ï¸ ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€æ‹¡å¼µå­`.csv`ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã—ã¦ãã ã•ã„ã€‚");
    
    // CSVãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
    dv.paragraph("```csv\n" + csvContent + "\n```");
    
    // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç”¨ãƒªãƒ³ã‚¯ï¼ˆå‚è€ƒæƒ…å ±ï¼‰
    dv.paragraph("ğŸ’¡ **ä½¿ã„æ–¹**: ä¸Šè¨˜ã®CSVãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€ãƒ¡ãƒ¢å¸³ã‚„Excelã«è²¼ã‚Šä»˜ã‘ã¦ä¿å­˜ã—ã¦ãã ã•ã„ã€‚");
}
```

---

## ğŸ” æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼

### ã‚ˆãä½¿ç”¨ã•ã‚Œã‚‹æ¤œç´¢ä¾‹

- **åŒ»ç™‚æ©Ÿé–¢ã§æ¤œç´¢**: `éˆ´é¹¿åšç”Ÿç—…é™¢`
- **åœ°åŸŸã§æ¤œç´¢**: `éˆ´é¹¿å¸‚`
- **ä¸»æ²»åŒ»ã§æ¤œç´¢**: `å¤§äº•`
- **åˆ©ç”¨çŠ¶æ³ã§æ¤œç´¢**: ä¸Šè¨˜ã®è¡¨ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½ã‚’ä½¿ç”¨

---

## ğŸ“‹ ç®¡ç†ãƒ¡ãƒ¢

### æ¬¡å›ãƒã‚§ãƒƒã‚¯é …ç›®
- [ ] æ–°è¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®æƒ…å ±å…¥åŠ›ç¢ºèª
- [ ] åˆ©ç”¨çŠ¶æ³ã®æ›´æ–°ãŒå¿…è¦ãªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç¢ºèª
- [ ] åŒ»ç™‚æ©Ÿé–¢æƒ…å ±ã®æœ€æ–°åŒ–
- [ ] CSVå‡ºåŠ›ã«ã‚ˆã‚‹å®šæœŸãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

### ã‚·ã‚¹ãƒ†ãƒ ä¿å®ˆ
- [ ] Database Folderãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®æ›´æ–°ç¢ºèª
- [ ] ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®è¦‹ç›´ã—
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®šã®æœ€é©åŒ–

---

**ğŸ“ ã‚·ã‚¹ãƒ†ãƒ ã‚µãƒãƒ¼ãƒˆ**: æŠ€è¡“çš„ãªå•é¡Œã‚„è¿½åŠ æ©Ÿèƒ½ã®ã”è¦æœ›ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚ 